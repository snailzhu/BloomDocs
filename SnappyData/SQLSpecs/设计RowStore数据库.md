##设计RowStore数据库
###与传统的数据库设计不同，RowStore需要设计人员分析常见的访问模式，并选择一种分区策略，导致将修剪到单个分区的查询。此外，维数表可能需要复制，以使数据可用于与分区数据的连接操作。这些章节描述了您可以使用RowStore实现线性缩放的基本表设计原则。
<br/>
##可扩展，分区感知数据库 的设计原则实现线性缩放的关键设计目标是使用分区策略，允许将大多数数据访问（查询）修剪到单个分区。这样可以避免查询执行期间跨多个分区的昂贵的锁定操作。
<br/>

实现线性缩放的关键设计目标是使用分区策略，允许将大多数数据访问（查询）修剪到单个分区。这样可以避免查询执行期间跨多个分区的昂贵的锁定操作。
<br/>

在具有数千个连接的高度并发系统中，多个查询通常在整个数据集（因此跨所有分区）上均匀分布。因此，增加数据存储的数量可实现线性可扩展性。给定足够的网络性能，可以支持额外的连接，而不会降低查询的响应时间。
<br/>
设计RowStore数据库的一般策略是识别在RowStore集群中分区或复制的表，然后确定分区表的正确分区键。这通常需要一个迭代过程来产生最佳设计：
<br/>

读取标识实体组和分区密钥并复制维度表以了解定义分区表或复制表的基本规则。<br/>
评估您的数据访问模式以定义作为分区候选的实体组。将您的努力集中在共同实体上。请记住，所有连接查询必须对共址的数据执行。在此版本中，RowStore仅支持数据位于同一位置的连接。共址数据对于事务更新也很重要，因为事务可以执行而不需要多阶段提交协议中的分布式锁定。
<br/>
识别实体组中的所有表表。<br/>
识别每个分区表的“分区键”。分区键是一组相关表中通用的列或一组列。在连接的表中查找父子关系。根实体的主键通常也是分区键的最佳选择。<br/>
注意： RowStore通过并行化跨数据存储的查询执行来支持分布式查询。但是，分区上的每个查询实例只能连接与分区数据并置的行。这意味着查询可以在分区表和数据存储上托管的任何数量的复制表之间连接行，而不受任何限制。但是，加入多个分区表的查询必须根据分区键进行过滤。查询示例在本节和查询功能和限制中提供。<br/>

识别候选复制的所有表。您可以复制表数据以实现高可用性，或者共同执行连接所必需的表数据。<br/>
示例：适应RowStore的数据库架构显示如何应用这些步骤将客户订单管理系统架构部署到RowStore。<br/>


###识别实体组和分区键 在关系数据库术语中，实体组对应于通过外键关系彼此相关的行。实体组的成员通常由父子关系关联，并且可以在单个分区中进行管理。要设计用于数据分区的RowStore数据库，请首先标识“实体组”及其关联的分区键。<br/>
###识别实体组和分区密钥
在关系数据库术语中，实体组对应于通过外键关系彼此相关的行。实体组的成员通常由父子关系关联，并且可以在单个分区中进行管理。要设计用于数据分区的RowStore数据库，请首先标识“实体组”及其关联的分区键。<br/>

例如：<br/>

在客户订单管理系统中，大多数交易一次处理与单个客户相关的数据。查询经常加入客户的结算信息及其订单和运输信息。对于这种类型的应用程序，您可以使用客户身份分区相关表。任何客户行及其“订单”和“运送”行都将单个实体组（客户ID作为实体组标识）（分区键）组成。您将使用客户身份分区相关表，这将使您能够通过添加更多成员来线性扩展系统以支持其他客户。<br/>
在管理产品目录（产品类别，产品规格，客户评论，回扣，相关产品等）的系统中，大多数数据访问一次重点关注单个产品。在这种类型的系统中，您可以在产品密钥上分区数据，并根据需要添加成员来管理其他产品。<br/>
在线拍卖应用程序中，您可能需要以非常低的延迟将收到的拍卖竞价流向数百个客户端。为此，您可以在单个分区上管理选定的“热”拍卖，从而获得足够的处理能力。随着处理需求的增加，您将添加更多分区，并将匹配出价的应用程序逻辑路由到客户端到数据存储本身。<br/>
在一个金融交易引擎中，不断匹配出价，要求成千上万个证券的价格，您将使用安全性的ID对数据进行分区。为了确保安全市场数据发生变化时的低延迟执行，您可以使用匹配算法将所有相关参考数据进行共同定位。<br/>
超越分布式事务的生命提供了有关实体组和分布式系统的更多背景信息。<br/>

创建分区表描述用于分区RowStore表的其他方法。<br/>

注意： Sharding是一种数据库分区策略，其中表行组存储在单独的数据库服务器和可能不同的同一模式实例上，创建可独立访问的数据组。RowStore确实鼓励应用程序使用分片技术。<br/>

通过识别识别实体组并使用这些组作为RowStore分区和托管的基础，您可以实现以下优点：<br/>

重新平衡： RowStore通过确保相关行一起迁移并且没有完整性损失，自动重新平衡数据。这使您可以根据需要添加容量。<br/>
分布式事务： RowStore事务边界不限于单个分区。在整个分布式系统中提供原子性和隔离保证。<br/>
并行散布集合：不能修剪到单个分区的查询将在数据存储上并行自动执行。可以在表之间执行连接，限制连接的行实际上是并置的。<br/>
远程分区的子查询：即使将查询修剪到单个分区，查询也可以执行对存储在远程分区上的数据进行操作的子查询。<br/>
###复制维度表 RowStore体系结构鼓励您在可能的情况下将“维”表反规范化为事实表，然后将剩余维度表复制到分布式系统中的所有数据存储。<br/>



RowStore体系结构鼓励您在可能时将“维”表反规范化为事实表，然后将剩余维度表复制到分布式系统中的所有数据存储。<br/>

大多数数据库遵循明星模式设计模式，其中大的“事实”表存储有关系统或业务流程中的事件的关键信息。例如，事实表将存储诸如产品销售或银行交易之类的事件的行。每个事实表通常与多个“维”表有外键关系，这些表描述了事实表中每一行的进一步方面。在前面的例子中，维度表将包含有关每个销售中涉及的产品或与每个交易相关联的帐户等的信息。
<br/>
在为RowStore设计数据库模式时，典型的星型模式数据库的主要目标是对实体表中的实体进行分区（请参阅标识实体组和分区键）。然后，应在承载分区事实表的每个数据存储上复制缓慢变化的维度表。以这种方式，可以在每个分区上同时执行事实表和其任何数量的维度表之间的连接，而不需要在分布式系统中与其他成员进行多次网络跳转。
<br/>
有关如何在RowStore中复制表的详细信息，请参阅复制表。
<br/>

示例：适应RowStore的数据库架构 如果您有要部署到RowStore的现有数据库设计，请将实体关系模型转换为针对RowStore设计原则进行了优化的物理设计。<br/>
###处理多对多关系 当表具有多对多关系时，您可以选择用于处理需要加入非共处理数据的查询的策略。<br/>
表格具有多对多关系的地方，您可以选择处理需要加入非共处理数据的查询的策略。<br/>


注意：只允许共享的数据连接。查询执行可以并行分发和执行，但每个分区成员中的连接行必须被限制在同一分区中的其他行。<br/>

对于表具有多对多关系，请选择以下策略之一来处理需要加入非共处理数据的查询：<br/>
使用并行的数据感知过程在存储部分或全部数据的成员上运行用于查询的逻辑（以最小化数据分发跳）。该过程应该执行多个查询，然后使用应用程序代码加入结果。编程数据感知过程和结果处理器提供更多信息。<br/>
将查询分成多个查询，并在应用程序客户端代码中执行加入。<br/>